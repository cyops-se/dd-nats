(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["views-TagTable"],{"4da5":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("file-drop",{attrs:{dialog:e.uploadDialog,multiple:!1,text:"Drop your CSV meta files here!"},on:{"update:dialog":function(t){e.uploadDialog=t},filesUploaded:function(t){return e.processUpload(t)}}}),a("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.items,search:e.search},scopedSlots:e._u([{key:"top",fn:function(){return[a("v-toolbar",{attrs:{flat:""}},[a("v-toolbar-title",[e._v("Tags")]),a("v-divider",{staticClass:"mx-4",attrs:{inset:"",vertical:""}}),a("v-spacer"),a("v-dialog",{attrs:{"max-width":"500px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",[a("v-card-title",[a("span",{staticClass:"text-h5"},[e._v("Tag")])]),a("v-card-text",[a("v-container",[a("v-row",[a("v-col",{attrs:{cols:"12"}},[a("v-text-field",{attrs:{label:"Name",readonly:""},model:{value:e.editedItem.name,callback:function(t){e.$set(e.editedItem,"name",t)},expression:"editedItem.name"}})],1)],1),a("v-row",[a("v-col",{attrs:{cols:"12"}},[a("v-combobox",{attrs:{items:e.availableGroups,"item-text":"name",label:"Group",outlined:""},model:{value:e.editedItem.group,callback:function(t){e.$set(e.editedItem,"group",t)},expression:"editedItem.group"}})],1)],1),a("v-row",[a("v-col",{attrs:{cols:"12"}},[a("v-textarea",{attrs:{label:"Description",outlined:""},model:{value:e.editedItem.description,callback:function(t){e.$set(e.editedItem,"description",t)},expression:"editedItem.description"}})],1)],1)],1)],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.close}},[e._v(" Cancel ")]),a("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.save}},[e._v(" Save ")])],1)],1)],1),a("v-text-field",{attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),a("v-btn",{staticClass:"ml-3",attrs:{color:"primary",dark:""},on:{click:e.exportCSV}},[e._v(" Export to CSV ")]),a("v-btn",{staticClass:"ml-3",attrs:{color:"primary",dark:""},on:{click:function(t){e.uploadDialog=!e.uploadDialog}}},[e._v(" Import from CSV ")]),a("v-btn",{staticClass:"ml-3",attrs:{color:"success",dark:"",disabled:e.saveDisabled},on:{click:e.saveChanges}},[e._v(" Save changes ")])],1)]},proxy:!0},{key:"item.actions",fn:function(t){var i=t.item;return[a("v-icon",{staticClass:"mr-2",on:{click:function(t){return e.editItem(i)}}},[e._v(" mdi-pencil ")]),a("v-icon",{on:{click:function(t){return e.deleteItem(i)}}},[e._v(" mdi-delete ")])]}}])})],1)},n=[],o=a("2909"),s=(a("7db0"),a("b0c0"),a("a434"),a("ac1f"),a("5319"),a("a15b"),a("99af"),a("d81d"),a("1276"),a("498a"),a("4de4"),a("2b0e")),r=a("c5fa"),l=a("4598"),c={name:"TagTableView",data:function(){return{dialog:!1,dialogDelete:!1,uploadDialog:!1,saveDisabled:!0,search:"",loading:!1,headers:[{text:"ID",align:"start",filterable:!1,value:"ID",width:75},{text:"Name",value:"name",width:"60%"},{text:"Group",value:"group.name",width:"20%"},{text:"Value",value:"value",width:"10%"},{text:"Changed",value:"changed",width:"10%"},{text:"New",value:"new",width:"10%"},{text:"Actions",value:"actions",width:1,sortable:!1}],items:[],editedIndex:-1,editedItem:{fullname:"",email:""},defaultItem:{fullname:"",email:""},availableGroups:[],groups:[],groupsTable:{}}},created:function(){this.update(),l["a"].topic("data.message",this,(function(e,t,a){for(var i=JSON.parse(t),n=0;n<i.points.length;n++){var o=i.points[n],r=a.items.find((function(e){return e.name===o.n}));r&&s["a"].set(r,"value",o.v)}}))},methods:{initialize:function(){},update:function(){var e=this;this.loading=!0,r["a"].get("data/opc_tags").then((function(t){e.items=t.data,e.loading=!1})).catch((function(e){console.log("ERROR response: "+JSON.stringify(e))})),r["a"].get("data/opc_groups").then((function(t){e.groups=t.data,e.availableGroups=e.groups})).catch((function(e){console.log("ERROR response: "+JSON.stringify(e))}))},editItem:function(e){this.editedIndex=this.items.indexOf(e),this.editedItem=Object.assign({},e),this.editedItem.groupname=e.group.name,this.dialog=!0},deleteItem:function(e){var t=this;r["a"].delete("data/opc_tags/"+e.ID).then((function(a){for(var i=0;i<t.items.length;i++)t.items[i].ID===e.ID&&t.items.splice(i,1);t.$notification.success("Tag deleted")})).catch((function(e){console.log("ERROR response: "+e.message)}))},close:function(){var e=this;this.dialog=!1,this.$nextTick((function(){e.editedItem=Object.assign({},e.defaultItem),e.editedIndex=-1}))},save:function(){var e=this;this.editedIndex>-1?(Object.assign(this.items[this.editedIndex],this.editedItem),r["a"].put("data/opc_tags",this.editedItem).then((function(e){})).catch((function(t){e.$notification.error("Failed to update tag!"+t)}))):(this.items.push(this.editedItem),r["a"].post("data/opc_tags",this.editedItem).then((function(e){})).catch((function(t){e.failureMessage("Failed to add tag!"+t)}))),this.close()},exportCSV:function(){var e="data:text/csv;charset=utf-8,";e+=["name;groupid;"].concat(Object(o["a"])(this.items.map((function(e){return e.name+";"+e.groupid+";"})))).join("\n").replace(/(^\[)|(\]$)/gm,"");var t=encodeURI(e),a=document.createElement("a");a.setAttribute("href",t),a.setAttribute("download","export.csv"),a.click()},processUpload:function(e){var t=new FileReader,a=this;t.onload=function(e){var t=a.csvJSON(e.target.result);a.content=t,a.processResponse(t)},console.log("loading file: "+e[0].name),t.readAsText(e[0])},csvJSON:function(e){var t=e.split("\n"),a=[];return t.map((function(e,t){if(!(t<1)){var i=e.split(";");a.push(i)}})),a},processResponse:function(e){for(var t=0;t<e.length;t++){var a,i=e[t],n=i[0].trim(),o=parseInt(i[1]),s=!1;if(""!==n){for(var r=0;r<this.groups.length;r++)if(this.groups[r].ID===o){a=this.groups[r];break}for(var l=0;l<this.items.length;l++){var c=this.items[l];if(c.name===n){s=!0;var d=c.groupid===o;d?c.changed=!1:(c.groupid=o,c.group=a,c.changed=!0);break}}if(!s){var u={name:n,groupid:o,group:a,new:!0};this.items.push(u)}}}this.items=this.items.filter((function(e){return!0===(null===e||void 0===e?void 0:e.changed)||!0===(null===e||void 0===e?void 0:e.new)||!1})),0===this.items.length?(this.$notification.error("No new or changed items identified"),this.update()):this.saveDisabled=!1},saveChanges:function(){var e=this;r["a"].post("opc/tag/changes",this.items).then((function(t){e.$notification.success("Changes saved"),e.update()})).catch((function(t){e.$notification.error("Failed to save changes: "+t)}))}}},d=c,u=a("2877"),p=a("6544"),v=a.n(p),m=a("8336"),h=a("b0af"),f=a("99d9"),g=a("62ad"),b=a("2b5d"),x=a("a523"),I=a("8fea"),w=a("169a"),k=a("ce7e"),V=a("132d"),C=a("0fd9"),D=a("2fa4"),T=a("8654"),_=a("a844"),S=a("71d9"),O=a("2a7f"),R=Object(u["a"])(d,i,n,!1,null,null,null);t["default"]=R.exports;v()(R,{VBtn:m["a"],VCard:h["a"],VCardActions:f["a"],VCardText:f["b"],VCardTitle:f["c"],VCol:g["a"],VCombobox:b["a"],VContainer:x["a"],VDataTable:I["a"],VDialog:w["a"],VDivider:k["a"],VIcon:V["a"],VRow:C["a"],VSpacer:D["a"],VTextField:T["a"],VTextarea:_["a"],VToolbar:S["a"],VToolbarTitle:O["a"]})}}]);
//# sourceMappingURL=views-TagTable.03e15fc2.js.map